if (typeof isAutomirrorLoaded !== 'undefined') {
  throw new Error('automirror already loaded');
}


var dermacolPageType;
var isAutomirrorLoaded=1;

var virtooalMirrorSettings = {
  userName: "8002",
  apiKey: "4b521b5dabfc330f53df3743390ea2f1",
  mirrorWidth: "270",
  lang: "en",
  title: "Espejo Virtual",
  titleLeft: "Espejo",
  titleRight: "Virtual",
  tryon_text: "",
  color: "000000",
  color2: "000000",
  side: "right",
  maxContentWidth: 0,
  marginFromContent: 10,
  model:"14",
  modelMale:"18",
  modelKids:"79",
  modelC:"",
  modelMaleC:"",
  fullscreenWidth:1,
  openFullScreenDesktop:"0",
  loadFirstProduct:"yes",
  LiveAsDefault:"0",
  mirrorVersion:"2",
  hasEarrings:"",
  hasContactLenses:"",
  hideIfNoProduct:"yes",
  browse:true,
  state:"minimized",
  iconShowMobile:"0",
  closeLiveOnMinimize:"1",
      mirror_enabled: "1",
  widget_enabled: "",
  ps_enabled: "0",
  ps_color_primary: "000000",
  ps_color_secondary: "000000",
  ps_info: "",
  ps_btn_pos: "0",
  ps_model_list: "",
  white_label: "0"
}


var elemDivVirtooal = document.createElement('div');
elemDivVirtooal.innerHTML = '<div id="virtooal-mirror-fix-container"><div id="virtooal-mirror-fix-content"><div id="virtooal-mirror-title"></div><div id="virtooal-mirror-fix-iframe"></div></div></div>';
document.body.appendChild(elemDivVirtooal);




if (virtooalMirrorSettings.mirrorVersion != "2") {
var po_virtooal = document.createElement('script'); 
po_virtooal.type = 'text/javascript'; 
po_virtooal.async = true;
po_virtooal.src = 'https://mirror.virtooal.com/assets/js/widget_min.js';

var s_virtooal = document.getElementsByTagName('script')[0]; 
s_virtooal.parentNode.insertBefore(po_virtooal, s_virtooal);
}

var virtooalCrossmirrorScript = document.createElement('script'); 
virtooalCrossmirrorScript.type = 'text/javascript'; 
virtooalCrossmirrorScript.async = true;
//console.log(virtooalMirrorSettings.mirrorVersion);

// if domain is duosshop.hr or duosshop.ro do nothing

if (window.location.href.indexOf('duosshop.hr') > -1 || window.location.href.indexOf('duosshop.ro') > -1) {
    virtooalCrossmirrorScript.src = '';
}
else if (window.location.href.indexOf('zoff.co.jp') > -1) {
    //virtooalCrossmirrorScript.src = `https://tryon.aws.prod.auglio.com/${virtooalMirrorSettings.apiKey}?legacy=1&preview=${window.location.href.indexOf('preview=1') > -1 ? 1 : 0}`;
    virtooalCrossmirrorScript.src = `https://tryon.auglio.com/${virtooalMirrorSettings.apiKey}?legacy=1&preview=${window.location.href.indexOf('preview=1') > -1 ? 1 : 0}`;
}
else if (window.location.href.indexOf('augliotestingv2') > -1) {
  virtooalCrossmirrorScript.src = `https://tryon.auglio.com/${virtooalMirrorSettings.apiKey}?legacy=1&preview=${window.location.href.indexOf('preview=1') > -1 ? 1 : 0}`;
}
else if (window.location.href.indexOf('presentation=1') > -1) {
  virtooalCrossmirrorScript.src = `https://tryontest.auglio.com/${virtooalMirrorSettings.apiKey}?legacy=1&preview=${window.location.href.indexOf('preview=1') > -1 ? 1 : 0}&presentation=${window.location.href.indexOf('presentation=1') > -1 ? 1 : 0}`;
}
else if (virtooalMirrorSettings.mirrorVersion == "2") {
  virtooalCrossmirrorScript.src = `https://tryon.auglio.com/${virtooalMirrorSettings.apiKey}?legacy=1&preview=${window.location.href.indexOf('preview=1') > -1 ? 1 : 0}`;
  //virtooalCrossmirrorScript.src = `https://tryon.aws.prod.auglio.com/${virtooalMirrorSettings.apiKey}?legacy=1&preview=${window.location.href.indexOf('preview=1') > -1 ? 1 : 0}`;
}
else if (window.location.href.indexOf('?test=mirrorb') > -1) {
  virtooalCrossmirrorScript.src = 'https://mirrorbtest.virtooal.com/assets/js/crossmirror.php?v=1721050009';
}
else if (virtooalMirrorSettings.mirrorVersion == "1") {
  virtooalCrossmirrorScript.src = 'https://mirrorv16.auglio.com/assets/js/crossmirror.php?v=1713349951';
}
else if (window.location.href.indexOf('?test=new') > -1) {
  virtooalCrossmirrorScript.src = 'https://mirrorv16.auglio.com/assets/js/crossmirror.php?v=1713349951';
}
else if (window.location.href.indexOf('?test=1') < 1) {
  virtooalCrossmirrorScript.src = 'https://mirror.virtooal.com/assets/js/crossmirror.php?v=1721050009';
}
else {
  virtooalCrossmirrorScript.src = 'https://mirrorparts.virtooal.com/assets/js/crossmirror.php?v=186'; 
}

var s_virtooal = document.getElementsByTagName('script')[0]; 
s_virtooal.parentNode.insertBefore(virtooalCrossmirrorScript, s_virtooal);

/**
 * @param {number|string} productId ID produktu, ktorý chceme zobraziť v mirror-e
 * @param {boolean} [triggerClick] Ak chceme vypnúť automatický click na `try on button`
 * @param {number} [buttonIndex] Ak je na stránke viac button-ov a potrebujeme zacieliť na nejaký konkrétny, tak zadáme jeho poradie
 */
function virtooalTryOnBtn_setId(productId, triggerClick = true, buttonIndex = 0) {
    if (!productId) {
        throw "Product ID must be provided.";
    }

    /** @type {NodeListOf<HTMLElement>} */
    const tryOnBtns = document.querySelectorAll(':not(.virtooal-tryon-btn-catalog).virtooal-tryon-btn');
    /** @type {number} */
    const len = tryOnBtns.length;
    if (!len) {
        throw 'Virtooal try on button does not exist.';
    }

    // Ošetrenie nesprávnych indexov
    if (buttonIndex < 0) {
        buttonIndex = 0;
    } else if (buttonIndex > len - 1) {
        buttonIndex = len - 1;
    }

    /** @type {HTMLElement} */
    const tryOnBtn = tryOnBtns[buttonIndex];

    tryOnBtn.dataset.virtooal_id = productId.toString();

    /** @var {{virtooalMirrorState?: number}} window */
    /** @type {number | null} */
    const mirrorState = virtooalMirrorState || window?.virtooalMirrorState || null;
    if (mirrorState === null) {
        throw "Try on mirror state does not exist.";
    }

    if (triggerClick && (mirrorState === 2 && window.innerWidth > 640)) {
        setTimeout(() => tryOnBtn.click(), 100);
    }
}

if (virtooalMirrorSettings.mirrorVersion != "2" && window.location.href.indexOf('augliotestingv2') === -1) {

    if (window.location.href.indexOf('preview=1') > -1) {
        //preview mode
        virtooalAddBtnsPreview();
    } else {
        virtooalAddBtns();
    }
}

//add buttons personalized functions
function virtooalAddBtns(refresh){
    //check personalized function
    }

//preview mode
function virtooalAddBtnsPreview(refresh){
    //check personalized function
    }
